{% extends 'Base/base_app.html' %}
{% load static %}
{% block title %}Editar autom&oacute;vil{% endblock %}
{% block content_main %}
    <div class="row">
        <div class="12u">

            <!-- Form -->
            <section class="box">
                <h3>Actualizar Autom&oacute;vil</h3>
                <a href="{% url 'Panel:CarList' %}" class="button small">Atr&aacute;s</a>
                <br><br>
                <form id="singUpForm" method="post" action="{% url 'Register:EditCar' car.pk %}"
                      enctype="multipart/form-data">
                    {% if errors %}
                        <div class="row uniform 50%">
                            <div class="12u 12u(mobilep)">
                                {% for error in errors %}
                                    <p style="color: red">*{{ error }}</p>
                                {% endfor %}
                            </div>
                        </div>
                    {% endif %}

                    {% if created %}
                        <div class="row uniform 50%">
                            <div class="12u 12u(mobilep)">
                                <p style="color: green">¡Registro exitoso! <a
                                        href="{% url 'Authentication:ChoiceLogin' %}">Inicia sesi&oacute;n</a></p>
                            </div>
                        </div>
                    {% endif %}
                    <div class="row uniform 50%">
                        <div class="4u 12u(mobilep)">
                            <input type="text" name="brand" id="brand" value="{{ car.brand }}" placeholder="Marca"/>
                        </div>
                        <div class="4u 12u(mobilep)">
                            <input type="text" name="model" id="model" value="{{ car.model }}" placeholder="Modelo"/>
                        </div>
                        <div class="4u 12u(mobilep)">
                            <input type="text" name="registration_tag" id="registration_tag"
                                   value="{{ car.registration_tag }}" placeholder="Matrícula"/>
                        </div>
                    </div>
                    <div class="row uniform 50%">
                        <div class="4u">
                            <input type="text" name="color" id="color" value="{{ car.color }}" placeholder="Color"/>
                        </div>
                        <div class="4u" style="display: -webkit-inline-box;">
                            <label for="total_sits">Espacios</label> &nbsp;
                            <input type="number" min="1" max="6" name="total_sits" id="total_sits" value="{{ car.total_sits }}"/>
                        </div>
                    </div>
                    <div class="row uniform 50%">
                        <div class="4u 12u(mobilep)" align="center">
                            <input type="file" name="insurance_policy" id="insurance_policy"
                                   value="{{ car_documents.insurance_policy }}" style="display: none;">
                            <input type="button" onclick="document.getElementById('insurance_policy').click();"
                                   class="button special icon fa-search" value="Poliza de seguro">
                            <br>
                            <span class="image fit" style="margin-top: 10px"><img id="insurance_policy_preview"
                                                                                  src="/{{ car_documents.insurance_policy }}"
                                                                                  alt=""/></span>
                        </div>
                        <div class="4u 12u(mobilep)" align="center">
                            <input type="file" name="circulation_card" id="circulation_card"
                                   value="{{ car_documents.circulation_card }}" style="display: none;">
                            <input type="button" onclick="document.getElementById('circulation_card').click();"
                                   class="button special icon fa-search" value="Tarjeta de circulación">
                            <br>
                            <span class="image fit" style="margin-top: 10px"><img id="circulation_car_preview"
                                                                                  src="/{{ car_documents.circulation_card }}"
                                                                                  alt=""/></span>
                        </div>
                        <div class="4u 12u(mobilep)" align="center">
                            <input type="file" name="licence" id="licence" value="{{ car_documents.licence }}"
                                   style="display: none;">
                            <input type="button" onclick="document.getElementById('licence').click();"
                                   class="button special icon fa-search" value="Licencia">
                            <br>
                            <span class="image fit" style="margin-top: 10px"><img id="licence_preview"
                                                                                  src="/{{ car_documents.licence }}"
                                                                                  alt=""/></span>
                        </div>
                    </div>
                    <div class="row uniform">
                        <div class="12u" align="center">
                            <ul class="actions">
                                <li><a href="{% url 'Panel:Panel' %}" class="button">Cancelar</a></li>
                                <li><input id="register-btn" class="button special" type="submit" value="Guardar cambios"/></li>
                            </ul>
                        </div>
                    </div>
                </form>

                <hr/>
            </section>

        </div>
    </div>
{% endblock %}

{% block scripts %}
    <script>
        function readURL(input, img_src) {
            if (input.files && input.files[0]) {
                var reader = new FileReader();

                reader.onload = function (e) {
                    if (img_src == "insurance_policy") {
                        $('#insurance_policy_preview').attr('src', e.target.result);
                    }

                    if (img_src == "circulation_card") {
                        $('#circulation_car_preview').attr('src', e.target.result);
                    }

                    if (img_src == "licence") {
                        $('#licence_preview').attr('src', e.target.result);
                    }
                };

                reader.readAsDataURL(input.files[0]);
            }
        }

        $("#insurance_policy").change(function () {
            readURL(this, "insurance_policy");
        });

        $("#circulation_card").change(function () {
            readURL(this, "circulation_card");
            console.log("circulation card");
        });

        $("#licence").change(function () {
            readURL(this, "licence");
        });

        var car_updated = '{{ car_updated }}';

        if (car_updated == 'correct') {
            alert('¡Automovil editado correctamente!');
        }

    </script>


{% endblock %}